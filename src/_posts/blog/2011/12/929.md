title: PHP中文件缓存转内存缓存的方法
date: 2011-12-22 18:00:56
---

顾名思义文件缓存转内存缓存就是将存储在文件中的数据转到内存中去，实现磁盘操作转为内存操作，这样可以大大提高数据访问速度，并能实现缓存数据的分布式部署。文件缓存与内存缓存的介绍请参考名词解释部分<br />
前言&nbsp;<br />
顾名思义文件缓存转内存缓存就是将存储在文件中的数据转到内存中去，实现磁盘操作转为内存操作，这样可以大大提高数据访问速度，并能实现缓存数据的分布式部署。文件缓存与内存缓存的介绍请参考名词解释部分。&nbsp;<br />
<br />
<br />
原理&nbsp;<br />
文件缓存转内存缓存的原理就是把文件缓存中的数据转存到内存中，以实现数据全局共享，解决频繁加载文件和装载数据的问题，采用Memcache工具实现内存缓存数据。&nbsp;<br />
<br />
<br />
实现机制与步骤&nbsp;<br />
1，检查文件是否存在内存缓存，如果不存在加载缓存文件&nbsp;<br />
2，加载缓存文件，并获取缓存文件中的数据&nbsp;<br />
3，将缓存文件中的数据写入内存&nbsp;<br />
4，从内存中获取数据，并将数据注册为全局变量&nbsp;<br />
5，返回数据&nbsp;<br />
<br />
<br />
这个过程中最主要处理两个问题，第一个问题是缓存文件加载，如果要实现文件缓存转内存缓存，就需要有一个统一的文件缓存路径调度服务，用于实现文件是否实现内存缓存机制。第二个问题是如何注册全局变量，不管是从文件中获取数据还是内存中获取，如果需要实现通用，就需要有一个注册全局变量的机制。&nbsp;<br />
<br />
<br />
文件缓存路径调度服务这个问题实现比较简单，但成本比较高，因为需要重构现在的文件缓存加载路径方式。&nbsp;<br />
<br />
<br />
普通的文件缓存加载方式&nbsp;<br />
<br />
<br />
<pre class="prettyprint lang-php">require 'cache/config.php'; </pre>
<br />
<br />
<br />
文件缓存路径调度方式&nbsp;<br />
<br />
<br />
<pre class="prettyprint lang-php">require getCachePath('cache/config.php'); </pre>
<br />
<br />
<br />
上例中getCachePath()函数实现文件缓存路径调度服务。&nbsp;<br />
<br />
<br />
其次是注册全局变量问题，需要考虑到数据的全局通用性，因此在使用上就有很多的注意事项，经过研究发现如下两种注册全局变量方式&nbsp;<br />
1，循环注册&nbsp;<br />
代码如下:<br />
<br />
<br />
<pre class="prettyprint lang-php">foreach ( $vars as $k =&gt; $v ) { 
$GLOBALS[$k] = $v; 
} 
</pre>
<br />
<br />
优点：重复键的情况下可保证最新的值正常&nbsp;<br />
缺点：$vars数组的大小决定执行时间&nbsp;<br />
<br />
<br />
2，直接追加&nbsp;<br />
<br />
<br />
<pre class="prettyprint lang-php">$GLOBALS += $vars; </pre>
<br />
<br />
<br />
优点：无循环，直接操作&nbsp;<br />
缺点：如果键存在则不能写入&nbsp;<br />
<br />
<br />
总结&nbsp;<br />
文件缓存转内存缓存最主要处理文件加载方式与全局变量注册，在实际的应用过程中，要特别注意各缓存文件中变量名的不同，如果变量名存在相同，则可能在多个文件加载过程中造成数据覆盖。&nbsp;<br />
<br />
<br />
在具体的开发实践中，能使用内存缓存则直接使用内存缓存，同时如果存在大量文件缓存加载的情况下，考虑实现文件缓存转内存缓存的机制。&nbsp;<br />
<br />
<br />
<br />
<br />
名词解释&nbsp;<br />
文件缓存是指将从数据库获取的数据存入文件中，这样下一次获取数据的时候就不需要从数据库获取而直接从文件中获取，这样就能够提升数据的访问速度，因此在很多的开源程序代码中都能看文件缓存的应用。&nbsp;<br />
<br />
<br />
内存缓存是指将从数据库获取的数据存入内存中，目前应用比较广泛的如Memcache。<br />